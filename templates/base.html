<!DOCTYPE html>
<html lang="en" ng-app>
<head>
	<title>go read</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="{{.BootstrapCss}}" rel="stylesheet">
	<style>
		.ng-cloak {
			display: none;
		}
		body {
			padding-top: 40px;
		}
		.hand {
			cursor: hand;
			cursor: pointer;
		}
		#nav-right {
			position: absolute;
			right: 0;
			left: auto;
		}
		.story {
			border-bottom: 1px solid #ccc;
			border-left: 1px solid #fff;
		}
		.story.selected {
			border-left: 1px solid #0088cc;
		}
		.story-header {
			position: relative;
			padding-left: 155px;
			padding-right: 120px;
			width: 100%;
			box-sizing: border-box;
			-moz-box-sizing: border-box;
			height: 33px;
			line-height: 33px;
			font-size: 13px;
		}
		.story-title, .feed-title, .folder-title {
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.story-header.read {
			background-color: #f5f5f5;
		}
		.story-feed {
			width: 145px;
			overflow: hidden;
			text-overflow: ellipsis;
			position: absolute;
			white-space: nowrap;
			left: 5px;
		}
		.story-date {
			position: absolute;
			right: 5px;
			top: 0;
		}
		.story-content h3 {
			margin: 0;
			margin-top: 4px;
			line-height: 24px;
		}
		.story-content {
			margin-left: 4px;
		}
		.active-name {
			font-weight: bold;
			padding: 10px 0;
		}
		#story-list {
			position: absolute;
			left: 245px;
			overflow-y: auto;
			top: 40px;
			bottom: 0;
			right: 0;
		}
		#story-list.no-nav {
			left: 20px;
		}
		#story-list .config {
			margin-right: 20px;
		}
		#feed-list {
			position: absolute;
			font-size: 13px;
			width: 220px;
			top: 40px;
			bottom: 0;
			overflow-y: auto;
			left: 20px;
		}
		.feed-child {
			margin-left: 20px;
		}
		.feed-icon {
			width: 16px;
			height: 16px;
			vertical-align: text-top;
		}
		.all-subs {
			font-weight: bold;
			padding: 5px 0;
		}
		.top-margin {
			margin-top: 20px;
		}
		a.brand {
			background-image: url("/static/icon.png");
			background-repeat: no-repeat;
			background-position: 20px 7px;
			background-size: 24px;
			padding-left: 54px !important;
		}
		.bold {
			font-weight: bold;
		}
		@media (max-width: 979px) {
			body {
				padding-top: 0;
			}
			body, .story-header, .story-content, .btn {
				font-size: 14px;
			}
			a.brand {
				background-position: 0px 7px;
				padding-left: 34px !important;
			}
			.navbar-fixed-top {
				margin-bottom: 0;
			}
			#feed-list {
				display: none;
			}
			#story-list {
				position: static;
				margin-left: -19px;
				margin-right: -19px;
			}
			.story-header {
				padding: 0;
				height: 43px;
				line-height: 43px;
			}
		}
	</style>
	<link rel="shortcut icon" href="/static/favicon.png">
</head>
<body ng-controller="GoreadCtrl" class="ng-cloak">
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<div class="container-fluid">
				<a class="brand" href="{{url "main"}}">go read</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li ng-class="{active: shown == 'about'}"><a href="#" ng-click="shown = 'about'">about</a></li>
					{{if .User}}
						<li ng-class="{active: shown == 'feeds'}" ng-init="shown = 'feeds'"><a href="#" ng-click="shown = 'feeds'; setActiveFeed();">feeds</a></li>
						<li>
							<li ng-click="shown = 'feeds'" class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" ng-init="mode = 'unread'">
									<span ng-show="mode == 'unread'">{{`{{unread.all || 'no'}}`}} unread items</span>
									<span ng-hide="mode == 'unread'">all items</span>
									<b class="caret"></b>
								</a>
								<ul class="dropdown-menu">
									<li><a href="#" ng-show="mode != 'unread'" ng-click="setMode('unread')">{{`{{unread.all || 'no'}}`}} unread items</a></li>
									<li><a href="#" ng-hide="mode != 'unread'" ng-click="setMode('all')">all items</a></li>
								</ul>
							</li>
						</li>
						<li>
							<form class="navbar-form">
								<button
									id="mark-all-read"
									class="btn btn-small"
									ng-click="markAllRead()"
									ng-disabled="stories.length == 0"
									data-url="{{url "mark-all-read"}}"
									data-url-read="{{url "mark-read"}}"
									data-url-contents="{{url "get-contents"}}"
									>mark all as read</button>
								<button
									id="refresh"
									class="btn btn-small"
									ng-click="refresh()"
									data-url-feeds="{{url "list-feeds"}}"
									><i class="icon-refresh"></i></button>
								<button class="btn btn-small" ng-click="next()" ng-disabled="stories.length == 0"><i class="icon-chevron-down"></i></button>
								<button class="btn btn-small" ng-click="prev()" ng-disabled="stories.length == 0"><i class="icon-chevron-up"></i></button>
								<button class="btn btn-small" ng-click="toggleExpanded()" ng-disabled="opts.expanded"><i class="icon-th-list"></i></button>
								<button class="btn btn-small" ng-click="toggleExpanded()" ng-disabled="!opts.expanded"><i class="icon-align-justify"></i></button>
							</form>
						</li>
						<li><a ng-show="loading" style="position: absolute">loading...</a></li>
					{{end}}
					</ul>
					<ul class="nav pull-right" id="nav-right">
					{{if .IsAdmin}}
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								admin
								<b class="caret"></b>
							</a>
							<ul class="dropdown-menu">
								<li><a href="{{ url "all-feeds-opml"}}">all feeds opml</a></li>
								<li><a href="{{ url "all-feeds"}}">all feeds</a></li>
								<li><a href="{{ url "admin-date-formats"}}">date formats</a></li>
								<li><a href="{{ url "admin-stats"}}">stats</a></li>
							</ul>
						</li>
					{{end}}
					{{if .User}}
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								{{.User}}
								<b class="caret"></b>
							</a>
							<ul class="dropdown-menu">
								<li><a href="{{url "import-reader"}}">import google reader</a></li>
								<li><a href="#" ng-click="shown = 'add-subscription'">add subscription</a></li>
								<li><a href="#" ng-click="shown = 'import-opml'">import opml</a></li>
								<li class="divider"></li>
								<li><a href="{{url "export-opml"}}">export opml</a></li>
								<li><a href="{{url "logout"}}">logout</a></li>
								{{if .IsDev}}
									<li class="divider"></li>
									<li><a href="{{url "clear-feeds"}}">clear feeds</a></li>
								{{end}}
							</ul>
						</li>
					{{else}}
						<li><a href="{{url "login-google"}}">sign up / log in</a></li>
					{{end}}
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row-fluid top-margin" ng-show="shown == 'about'">
			<div class="offset3 span6">
				<h1>About</h1>
				<p>Go Read is a web-based RSS reader.</p>
				<p>It is designed to be as useful as Google Reader.</p>
				<p>
					Built by <a href="http://mattjibson.com">Matt Jibson</a>.
					Runs on <a href="https://developers.google.com/appengine/">Google App Engine</a>.
					Powered by <a href="http://golang.org/">Go</a> and <a href="http://angularjs.org/">AngularJS</a>.
					Code on <a href="https://github.com/mjibson/goread">GitHub</a>.
				</p>
				<h1>FAQ</h1>
				<p>
					<strong>Are there keyboard shortcuts?</strong>
					Yes, press <button class="btn">?</button>.
				</p>
				<p>
					<strong>What is on your todo list?</strong>
					<ul>
						<li>google reader API compatability (so other reader clients can use go read as a backend)</li>
						<li>pubsubhubub support</li>
					</ul>
				</p>
				<p>
					<strong>How will you pay for this?</strong>
					Free version will be ad supported with hopefully non-annoying ads. Free version is not limited in any way.
					Or pay a reasonable monthly or yearly fee to remove them. If you don't like either of those options, download the code and upload it to your own app engine instance. Free quota supports up to a few hundred feeds.
				</p>
				<h1>Help</h1>
				<p>Problems? Try one of these:</p>
				<p>Tweet me <a href="https://twitter.com/mjibson">@mjibson</a></p>
				<p>Email me at <a href="mailto:matt.jibson@gmail.com">matt.jibson@gmail.com</a></p>
				<p>Submit a <a href="https://github.com/mjibson/goread/issues">GitHub issue</a></p>
			</div>
		</div>

		{{if .User}}
		<div class="row-fluid" ng-init="refresh()">
			<div ng-show="opts.nav && !nothing() && shown == 'feeds'" id="feed-list">
				<ul class="unstyled">
					<li class="all-subs hand" ng-click="setActiveFeed()">
						all items ({{`{{unread.all || 0}}`}})
					</li>
					<li ng-repeat="f in feeds">
						<div class="feed-title" ng-hide="f.Outline" ng-click="setActiveFeed(f.XmlUrl)">
							<img {{htmlattr `ng-src="{{icons[f.XmlUrl] || '/static/img/feed.png'}}"`}} class="feed-icon hand">
							<span class="hand" ng-class="{bold: unread['feeds'][f.XmlUrl]}" ng-bind="f.Title"></span>
							<span ng-show="unread['feeds'][f.XmlUrl]">
								({{`{{unread['feeds'][f.XmlUrl]}}`}})
							</span>
						</div>
						<div ng-show="f.Outline">
							<div ng-show="f.Outline" class="folder-title">
								<i class="icon-folder-open hand" ng-hide="opts.folderClose[f.Title]" ng-click="opts.folderClose[f.Title] = true; saveOpts()"></i>
								<i class="icon-folder-close hand" ng-show="opts.folderClose[f.Title]" ng-click="opts.folderClose[f.Title] = false; saveOpts()"></i>
								<span class="hand" ng-class="{bold: unread['folders'][f.Title]}" ng-bind="f.Title" ng-click="setActiveFolder(f.Title)"></span>
								<span ng-show="unread['folders'][f.Title]">
									({{`{{unread['folders'][f.Title]}}`}})
								</span>
							</div>
							<ul class="unstyled" ng-hide="opts.folderClose[f.Title]">
								<li ng-repeat="o in f.Outline">
									<div class="feed-title feed-child" ng-click="setActiveFeed(o.XmlUrl)">
										<img {{htmlattr `ng-src="{{icons[o.XmlUrl] || '/static/img/feed.png'}}"`}} class="feed-icon hand">
										<span class="hand" ng-class="{bold: unread['feeds'][o.XmlUrl]}" ng-bind="o.Title"></span>
										<span ng-show="unread['feeds'][o.XmlUrl]">
											({{`{{unread['feeds'][o.XmlUrl]}}`}})
										</span>
									</div>
								</li>
							</ul>
						</div>
					</li>
				</ul>
			</div>

			<div
				ng-show="loading == 0 && shown == 'feeds' && numfeeds"
				ng-class="navspan()"
				ng-style="navmargin()"
				id="story-list"
				data-url-upload="{{url "upload-opml"}}"
				data-url-options="{{url "save-options"}}"
				data-url-get-feed="{{url "get-feed"}}"
			>
				<div class="active-name story">
					<span ng-hide="activeFeed" ng-bind="active()"></span>
					<div ng-show="activeFeed">
						<a ng-href="{{`{{xmlurls[activeFeed].HtmlUrl || ''}}`}}" style="color: #333">
							{{`{{active()}}`}} Â»
						</a>
						<div class="pull-right btn-group config">
							<a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
								<i class="icon-cog"></i>
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								<li><a href="#" ng-click="rename(activeFeed)">rename</a></li>
								<li><a href="#" ng-click="unsubscribe(activeFeed)">unsubscribe</a></li>
								{{if .IsAdmin}}
									<li><a ng-href="{{url "admin-feed"}}?f={{`{{activeFeed}}`}}">admin</a></li>
								{{end}}
							</ul>
						</div>
					</div>
				</div>
				<div
					ng-repeat="s in dispStories"
					class="story"
					ng-mouseenter="overContents(s)"
					ng-mouseleave="leaveContents(s)"
					id="storydiv{{`{{$index}}`}}"
					ng-class="{selected: $index == currentStory}"
				>
					<div class="story-header hand" ng-class="{read: s.read}">
						<div class="story-feed muted visible-desktop" ng-click="setCurrent($index)" ng-bind="s.feed.Title"></div>
						<div class="story-title" ng-click="setCurrent($index)">
							<strong ng-bind="s.Title"></strong>
							<span class="story-summary muted" ng-show="s.Summary" ng-bind="'- ' + s.Summary"></span>
						</div>
						<div class="story-date muted visible-desktop">
							<span ng-bind="s.dispdate" ng-click="setCurrent($index)"></span>
							<a ng-href="{{`{{s.Link}}`}}" target="_blank"><i class="icon-share-alt"></i></a>
						</div>
					</div>
					<div class="story-content" ng-click="setCurrent($index, true)" ng-show="$index == currentStory || opts.expanded">
						<h3><a ng-href="{{`{{s.Link}}`}}" target="_blank" ng-bind="s.Title"></a></h3>
						<p><small>
							from <a ng-href="{{`{{s.feed.HtmlUrl}}`}}" ng-bind="s.feed.Title" target="_blank"></a>
							<span ng-show="s.Author">by {{`{{s.Author}}`}}</span>
						</small></p>
						<div ng-bind-html-unsafe="contents[s.guid]" class="clearfix"></div>
					</div>
				</div>
				<div ng-show="loading == 0 && shown == 'feeds' && numfeeds && dispStories.length == 0" class="top-margin">
					<div class="offset2 span8">
						<div class="hero-unit">
							<p class="text-center">No unread items.</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div ng-show="nothing()" class="row-fluid top-margin">
			<div class="offset2 span8">
				<p>You don't have any feeds.</p>
				<p>You should probably add some.</p>
				<p><a href="{{url "import-reader"}}">Import from Google Reader.</a></p>
			</div>
		</div>

		<div class="row-fluid top-margin" ng-show="shown == 'add-subscription' || nothing()">
			<div class="offset2 span8">
				<form id="add-subscription-form" data-url="{{url "add-subscription"}}">
					<fieldset>
						<legend>Feed URL (RSS or Atom)</legend>
						<input type="text" class="span12" ng-model="addFeedUrl">
						<p><button ng-click="addSubscription()" class="btn">import</button></p>
					</fieldset>
				</form>
			</div>
		</div>

		<div class="row-fluid top-margin" ng-show="shown == 'import-opml' || nothing()">
			<div class="offset2 span8">
				<form id="import-opml-form" enctype="multipart/form-data" method="POST" action="{{url "import-opml"}}">
					<fieldset>
						<legend>Upload OPML file</legend>
						<input type="file" name="file">
						<p><button ng-click="importOpml()" type="submit" class="btn">upload</button></p>
					</fieldset>
				</form>
			</div>
		</div>
		{{else}}
			<div class="row-fluid top-margin" ng-init="nouser = true">
				<div class="offset1 span10" ng-hide="shown">
					<div class="hero-unit">
						<h1>Hi, RSS user</h1>
						<p>Go Read is a web-based RSS reader.</p>
						<p>It is designed to be as useful as Google Reader.</p>
						<p><a class="btn btn-primary btn-large" href="{{url "login-google"}}">sign up / log in with google</a></p>
						<p class="alert alert-info">We've just released! Read the <strong><a href="http://mattjibson.com/blog/2013/06/26/go-read-open-source-google-reader-clone/">blog post</a></strong> about it.</p>
					</div>
				</div>
			</div>
		{{end}}
	</div>

	<div id="shortcuts" class="modal hide">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4>keyboard shortcuts</h4>
		</div>
		<div class="modal-body">
			<ul class="unstyled">
				<li><button class="btn btn-small">j/k</button> next/previous item</li>
				<li><button class="btn btn-small">n/p</button> next/previous item</li>
				<li><button class="btn btn-small">r</button> refresh</li>
				<li><button class="btn btn-small">space</button> next item</li>
				<li><button class="btn btn-small">&lt;Shift&gt; + space</button> previous item</li>
				<li><button class="btn btn-small">v</button> view original</li>
				<li><button class="btn btn-small">&lt;Shift&gt; + a</button> mark all as read</li>
				<li><button class="btn btn-small">a</button> add subscription</li>
				<li><button class="btn btn-small">g</button> then <button class="btn btn-small">a</button> go to all items</li>
				<li><button class="btn btn-small">u</button> hides/unhides the left hand side module</li>
				<li><button class="btn btn-small">1</button> switch to expanded view</li>
				<li><button class="btn btn-small">2</button> switch to list view</li>
			</ul>
		</div>
	</div>

	<div id="messages" class="modal hide" data-show="{{if .Messages}}true{{end}}">
		<div class="modal-body">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
				<div id="message-list">
				{{range .Messages}}
					<p>{{.}}</p>
				{{end}}
				</div>
		</div>
	</div>

	<script src="{{.Jquery}}"></script>
	<script src="{{.Underscore}}"></script>
	<script src="{{.BootstrapJs}}"></script>
	<script src="/static/js/jquery.form.js"></script>
	<script src="/static/js/mousetrap.min.js"></script>
	<script src="{{.Angular}}"></script>
	<script src="/static/js/moment.min.js"></script>
	<script src="/static/js/site.js"></script>

	{{.MiniProfiler}}

	{{if .GoogleAnalytics}}
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', '{{.GoogleAnalytics}}', 'go-read.appspot.com');
		ga('send', 'pageview');
	</script>
	{{end}}

	{{if .IsDev}}
		<script type="text/javascript">
			Mousetrap.bind('c', function() {
				window.location.replace("{{url "clear-feeds"}}");
			});
		</script>
	{{end}}
</body>
</html>
